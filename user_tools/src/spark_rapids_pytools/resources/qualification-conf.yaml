toolOutput:
  completeOutput: true
  subFolder: rapids_4_spark_qualification_output
  textFormat:
    summaryLog:
      fileName: rapids_4_spark_qualification_output.log
    log4jFileName: rapids_4_spark_qualification_stderr.log
  csv:
    unsupportedOperatorsReport:
      fileName: rapids_4_spark_qualification_output_unsupportedOperators.csv
    clusterInformation:
      fileName: rapids_4_spark_qualification_output_cluster_information.csv
    stagesInformation:
      fileName: rapids_4_spark_qualification_output_stages.csv
    execsInformation:
      fileName: rapids_4_spark_qualification_output_execs.csv
    tunings:
      subFolder: tuning
    appsStatusReport:
        fileName: rapids_4_spark_qualification_output_status.csv
    summaryReport:
      fileName: rapids_4_spark_qualification_output.csv
      columns:
        - Vendor
        - Driver Host
        - Cluster Id
        - Cluster Name
        - App Name
        - App ID
        - Estimated GPU Speedup
        - Estimated GPU Duration
        - App Duration
        - SQL Stage Durations Sum
        - Unsupported Operators Stage Duration
        - Unsupported Operators Stage Duration Percent
        - Total Core Seconds
      mapColumns:
      groupColumns:
         enabled: false
         keys:
           - Vendor
           - Driver Host
           - Cluster Id
           - Cluster Name
           - App Name
         aggregate:
           - column: App Duration
             function: 'mean'
           - column: Estimated GPU Duration
             function: 'mean'
           - column: Unsupported Operators Stage Duration
             function: 'mean'
           - column: Skip by Heuristics
             function: 'any'
           - column: SQL Stage Durations Sum
             function: 'mean'
      dropDuplicates:
        - Vendor
        - Driver Host
        - Cluster Id
        - Cluster Name
        - App Name
sparkRapids:
  mvnUrl: 'https://repo1.maven.org/maven2/com/nvidia/rapids-4-spark-tools_2.12'
  repoUrl: '{}/{}/rapids-4-spark-tools_2.12-{}.jar'
  toolsJarRegex: 'rapids-4-spark-tools_2.12-.*.jar'
  mainClass: 'com.nvidia.spark.rapids.tool.qualification.QualificationMain'
  outputDocURL: 'https://docs.nvidia.com/spark-rapids/user-guide/latest/qualification/quickstart.html#qualification-output'
  enableAutoTuner: true
  requireEventLogs: true
  gpu:
    device: 't4'
    workersPerNode: 2
    cudaVersion: '11.5'
  cli:
    defaults:
      costSavingsSettings: #temporrary settings to control the code behavior until the cost savings feature is fully removed
        enabled: false
    toolOptions:
      - all
      - any
      - a
      - application-name
      - f
      - filter-criteria
      - fs-end-time
      - fs-start-time
      - h
      - html-report
      - no-html-report
      - m
      - match-event-logs
      - min-event-log-size
      - max-event-log-size
      - max-sql-desc-length
      - ml-functions
      - n
      - no-recursion
      - num-output-rows
      - order
      - r
      - report-read-schema
      - s
      - spark-property
      - speedup-factor-file
      - start-app-time
      - t
      - timeout
      - u
      - user-name
local:
  output:
    cleanUp: true
    files:
      summary:
        name: qualification_summary.csv
        outputComment: "Summarized speedups CSV report"
      statistics:
        name: qualification_statistics.csv
        outputComment: "Statistics CSV report"
        columns:
          - 'App ID'
          - 'SQL ID'
          - 'Operator'
          - 'Count'
          - 'Stage Task Exec Duration(s)'
          - 'Total SQL Task Duration(s)'
          - '% of Total SQL Task Duration'
          - 'Supported'
      intermediateOutput:
        name: 'intermediate_output'
        outputComment: "Intermediate output generated by tools"
        isDirectory: true
        files:
          heuristics:
            name: 'heuristics_info.csv'
            outputComment: "Heuristics information"
      configRecommendations:
        name: 'rapids_4_spark_qualification_output/tuning'
        columns:
          - 'Full Cluster Config Recommendations*'
          - 'GPU Config Recommendation Breakdown*'
      appMetadata:
        name: app_metadata.json
        outputComment: "Metadata file with cluster recommendation and tuning details"
        columns:
          - 'App ID'
          - 'App Name'
          - 'Event Log'
          - 'Cluster Info'
          - 'Estimated GPU Speedup Category'
          - 'Full Cluster Config Recommendations*'
          - 'GPU Config Recommendation Breakdown*'
      appsStatusReport:
        name: 'rapids_4_spark_qualification_output/rapids_4_spark_qualification_output_status.csv'
        outputComment: "Application status report"
    costColumns:
      - 'Savings Based Recommendation'
      - 'Estimated App Cost'
      - 'Estimated GPU Cost'
      - 'Estimated GPU Savings(%)'
      - 'Estimated Job Frequency (monthly)'
      - 'Annual Cost Savings'
    savingColumn: 'Estimated GPU Savings(%)'
    savingRecommendColumn: 'Savings Based Recommendation'
    summaryColumns: #columns to be displayed on the stdout as part of the final report
      savingsReportEnabledTrue: #columns with savings estimates enabled
        - 'App ID'
        - 'App Name'
        - 'Savings Based Recommendation'
        - 'App Duration'
        - 'Estimated GPU Duration'
        - 'Estimated GPU Speedup'
        - 'Estimated GPU Savings(%)'
      savingsReportEnabledFalse: #columns with savings estimates disabled
        - 'App ID'
        - 'App Name'
        - 'App Duration'
        - 'Estimated GPU Duration'
        - 'Estimated GPU Speedup'
    treeDirectory:
      enabled: true
      depthLevel: 2
      indentation: '    '
      excludedPatterns:
        directories:
          - '^(css)$'
          - '^(js)$'
          - '^(assets)$'
          - '.+\$$'
          - '^.+(_\$folder\$)$'
        files:
          - '^(\.+).*'
          - '^(\$+).*'
          - '^.+(_\$folder\$)$'
          - '^rapids_4_spark_qualification_output.*'
    unsupportedOperators:
      mask:
        - operator: 'NOT_EQUAL'
          columnName: 'Action'
          value: 'IgnoreNoPerf'
        - operator: 'NOT_EQUAL'
          columnName: 'Unsupported Type'
          value: 'Expr'
        - operator: 'NOT_EQUAL'
          columnName: 'Stage ID'
          value: -1
      inputColumns:
        - 'App ID'
        - 'App Duration'
        - 'Stage ID'
        - 'Stage Duration'
      groupingColumns:
        max:
          - 'App ID'
          - 'App Duration'
          - 'Stage ID'
        sum:
          - 'App ID'
          - 'App Duration'
      resultColumnName: 'Unsupported Operators Stage Duration'
      percentResultColumnName: 'Unsupported Operators Stage Duration Percent'
    topCandidates:
      categoryColumnName: 'Estimated GPU Speedup Category'
      outputColumns:
        - 'App ID'
        - 'App Name'
        - 'Estimated GPU Speedup Category'
        - 'Qualified Cluster Recommendation'
        - 'Full Cluster Config Recommendations*'
        - 'GPU Config Recommendation Breakdown*'
      ineligibleCategory:
        - 'Not Recommended'
      eligibleCategories:
        - 'Small'
        - 'Medium'
        - 'Large'
      sortingColumns:
        - 'Speedup Category Order'
        - 'Total Core Seconds'
        - 'Unsupported Operators Stage Duration Percent'
      joinColumns:
        - 'App ID'
        - 'App Name'
        - 'App Duration'
      summaryReport:
        compactWidth: true
        timeUnits: 's'
        columnWidth: 14
    speedupCategories:
      speedupColumnName: 'Estimated GPU Speedup'
      categoryColumnName: 'Estimated GPU Speedup Category'
      heuristicsColumnName: 'Skip by Heuristics'
      categories:
        - title: 'Not Applicable'
          lowerBound: -1000000.0
          upperBound: 1.3
        - title: 'Small'
          lowerBound: 1.3
          upperBound: 2.0
        - title: 'Medium'
          lowerBound: 2.0
          upperBound: 3.0
        - title: 'Large'
          lowerBound: 3.0
          upperBound: 1000000.0
      eligibilityConditions:
        - columnName: 'Estimated GPU Speedup'
          lowerBound: 1.3
          upperBound: 1000000.0
        - columnName: 'Unsupported Operators Stage Duration Percent'
          lowerBound: 0.0
          upperBound: 25.0
      defaultCategory: 'Not Recommended'
    additionalHeuristics:
      appInfo:
        fileName: 'application_information.csv'
      resultCols:
        - 'App ID'
        - 'Skip by Heuristics'
        - 'Reason'
      totalCoreSecBased:
        # This is total core seconds of an 8-core machine running for 24 hours
        totalCoreSecThreshold: 691200
      spillBased:
        stageAggMetrics:
          fileName: 'stage_level_aggregated_task_metrics.csv'
          columns:
            - 'stageId'
            - 'memoryBytesSpilled_sum'
        sqlToStageInfo:
          fileName: 'sql_to_stage_information.csv'
          columns:
            - 'stageId'
            - 'SQL Nodes(IDs)'
        spillThresholdBytes: 10737418240
        allowedExecs:
          - 'Aggregate'
          - 'Join'
          - 'Sort'
    predictionModel:
      outputDirectory: 'xgboost_predictions'
      files:
        features:
          name: 'features.csv'
        perSql:
          name: 'per_sql.csv'
        perApp:
          name: 'per_app.csv'
        shapValues:
          name: 'shap_values.csv'
        featureImportance:
          name: 'feature_importance.csv'
      updateResult:
        subsetColumns:
          - 'appId'
          - 'speedup'
          - 'appDuration_pred'
        remapColumns:
          - srcCol: 'speedup'
            dstCol: 'Estimated GPU Speedup'
          - srcCol: 'appDuration_pred'
            dstCol: 'Estimated GPU Duration'
    clusterInference:
      cpuClusterColumns:
        - 'Num Worker Nodes'
        - 'Worker Node Type'
        - 'Cores Per Executor'
      gpuClusterColumns:
        - 'Recommended Num Worker Nodes'
        - 'Recommended Worker Node Type'
        - 'Recommended Cores Per Executor'

platform:
  shortName: 'qual'
  outputDir: qual-tool-output
  cleanUp: true
